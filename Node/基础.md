# 整理
nodejs 是一个 js 解析器

nodejs 中运行的 js 的用途是操作磁盘文件或搭建 HTTP 服务器，nodejs 相应提供了 fs、http 等内置对象

nodejs 的制造是为了实现高性能 Web 服务器，首先看重的是事件机制和异步 IO 模型的优越性，而不是 js，但是他需要选择一种编程语言实现他的想法，这种编程语言不能自带IO功能，并且需要能良好支持事件机制。js 没有自带 IO 功能，天生就是用来处理浏览器中的 DOM 事件，而且拥有一大群程序员，因此成了天然的选择。

### 运行

在 Linux 下，使用 nodejs 监听80或443端口提供 HTTP(S) 服务器时需要root权限：
```shell
$ sudo node server.js (推荐)
```
或使用`chmod +s`命令让 nodejs 总以 root 权限运行
```shell
$ sudo chown root /usr/local/bin/node
$ sudo chmod +s /usr/local/bin/node
```

### 模块

在 nodejs中，一般将代码合理拆分到不同的 js 文件中，每个文件就是一个模块，而文件路径就是模块名
使用 `CMD` 模块系统，主模块作为程序的入口，所有模块在执行过程中只初始化一次
在编写每个模块时，都有 `require、exports、module` 三个预先定义好的变量可供使用

**_require_**
require 函数用于在当前模块中加载和使用别的模块，传入一个模块名，返回一个模块导出的对象模块名可使用相对路径（./）或者绝对路径（/ or C:之类的开头），模块名中的 .js 可以省略
```js
// a1-a4保存的是同一模块的导出对象
var a1 = require('./foo')
var a2 = require('./foo.js')
var a3 = require('/foo')
var a4 = require('/foo.js')

// 加载和使用一个JSON文件
var data = require('./data.json')
```

**_exports_**
exports 对象是当前模块的导出对象，用于导出模块公有方法和属性
别的模块通过 require 函数使用当前模块时得到的就是当前模块的 exports 对象
```js
// 导出了一个对象
exports.hello = function () {
  console.log('hello')
}
```

**_module_**
通过 module 对象可以访问到当前模块的一些相关信息，但最多的用途是替换当前模块的导出对象
例如模块导出对象默认是一个普通对象，如果想改成一个函数的话，可以使用以下方式
```js
// 导出了一个函数
module.exports = function () {
  console.log('hello')
}
```

**_模块初始化_**
一个模块中的 js 代码仅在模块第一次被使用时执行一次，并在执行过程中初始化模块的导出对象，之后被缓存起来

**_主模块_**
通过命令行参数传递给 nodejs 以启动程序的模块被称为主模块
主模块负责调度组成整个程序的其他模块完成工作

```shell
// main.js 为主模块
$ node main.js
```

**_二进制模块_**
 （提供无限的潜能，超出前端的能力范围）
nodejs 也支持使用 C/C++ 编写二进制模块
编译好的二进制模块除了文件名是 .node 外，和 js 模块的使用方式相同。